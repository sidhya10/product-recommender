<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Product Recommender App with AI</title>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/react/18.2.0/umd/react.production.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/react-dom/18.2.0/umd/react-dom.production.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/babel-standalone/7.22.5/babel.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/lodash.js/4.17.21/lodash.min.js"></script>
  <!-- Tailwind CSS -->
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    html, body, #root {
      height: 100%;
      margin: 0;
      padding: 0;
    }
    #root {
      display: flex;
      flex-direction: column;
    }
  </style>
</head>
<body>
<div id="root"></div>

<script type="text/babel">
  // Import ProductRecommender component
  const ProductRecommender = (() => {
    const { useState, useRef, useEffect } = React;

    return () => {
      const [messages, setMessages] = useState([
        {
          role: 'assistant',
          content: 'Hi there! I can help you find the perfect tech product based on your needs. What are you looking for today? (For example: laptop, smartphone, headphones, etc.)'
        }
      ]);
      const [inputText, setInputText] = useState('');
      const [isTyping, setIsTyping] = useState(false);
      const [productContext, setProductContext] = useState({
        category: null,
        budget: null,
        preferences: [],
        stage: 'initial'
      });
      // Track which questions have been asked to prevent loops
      const [askedQuestions, setAskedQuestions] = useState({
        budget: false,
        features: false
      });
      const messagesEndRef = useRef(null);

      // OpenAI API configuration
      const OPENAI_API_KEY = "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";
      const API_BASE_URL = "https://api.openai.com/v1";

      // Sample product database
      const products = [
        {
          id: 1,
          category: 'laptop',
          name: 'ProBook X5',
          price: 1299,
          features: ['13" Retina display', '16GB RAM', '512GB SSD', 'All-day battery life', 'Ultra-lightweight'],
          idealFor: ['professionals', 'travelers', 'students', 'designers'],
          rating: 4.8,
          image: '/api/placeholder/300/200'
        },
        {
          id: 2,
          category: 'laptop',
          name: 'TechMaster 7000',
          price: 999,
          features: ['15.6" FHD display', '8GB RAM', '256GB SSD', 'Gaming graphics card', 'Customizable keyboard'],
          idealFor: ['gamers', 'students', 'casual users'],
          rating: 4.3,
          image: '/api/placeholder/300/200'
        },
        {
          id: 3,
          category: 'laptop',
          name: 'UltraSlim Pro',
          price: 1499,
          features: ['14" 4K OLED display', '32GB RAM', '1TB SSD', 'Precision touchpad', 'Professional graphics'],
          idealFor: ['designers', 'video editors', 'professionals'],
          rating: 4.9,
          image: '/api/placeholder/300/200'
        },
        {
          id: 4,
          category: 'smartphone',
          name: 'Galaxy Ultra',
          price: 899,
          features: ['6.7" Super AMOLED', '8GB RAM', '256GB Storage', 'Triple camera system', 'All-day battery'],
          idealFor: ['photographers', 'professionals', 'tech enthusiasts'],
          rating: 4.7,
          image: '/api/placeholder/200/300'
        },
        {
          id: 5,
          category: 'smartphone',
          name: 'Pixel Pro',
          price: 799,
          features: ['6.4" OLED display', 'Best-in-class camera', 'Clean OS experience', 'Fast charging', 'Long-term updates'],
          idealFor: ['photographers', 'Android purists', 'casual users'],
          rating: 4.6,
          image: '/api/placeholder/200/300'
        },
        {
          id: 6,
          category: 'smartphone',
          name: 'Budget King 5',
          price: 349,
          features: ['6.5" LCD display', 'Decent camera', '128GB Storage', 'Headphone jack', 'Expandable storage'],
          idealFor: ['budget-conscious users', 'students', 'casual users'],
          rating: 4.2,
          image: '/api/placeholder/200/300'
        },
        {
          id: 7,
          category: 'headphones',
          name: 'SoundMaster Pro',
          price: 299,
          features: ['Active noise cancellation', 'Hi-Res audio', '30-hour battery life', 'Premium build quality', 'Spatial audio'],
          idealFor: ['audiophiles', 'travelers', 'professionals'],
          rating: 4.8,
          image: '/api/placeholder/300/200'
        },
        {
          id: 8,
          category: 'headphones',
          name: 'BassBoost 700',
          price: 179,
          features: ['Enhanced bass response', 'Comfortable fit', '25-hour battery life', 'Built-in mic', 'Foldable design'],
          idealFor: ['bass lovers', 'commuters', 'casual listeners'],
          rating: 4.4,
          image: '/api/placeholder/300/200'
        },
        {
          id: 9,
          category: 'headphones',
          name: 'EcoSound Mini',
          price: 89,
          features: ['Compact design', 'Good sound quality', '20-hour battery', 'Water resistant', 'Built-in controls'],
          idealFor: ['budget-conscious users', 'gym-goers', 'casual listeners'],
          rating: 4.1,
          image: '/api/placeholder/300/200'
        }
      ];

      // Auto-scroll to bottom of messages
      useEffect(() => {
        messagesEndRef.current?.scrollIntoView({ behavior: 'smooth' });
      }, [messages]);

      // Improved OpenAI API function with better error handling
      const callOpenAI = async (prompt, context) => {
        console.log("Calling OpenAI API with prompt:", prompt);

        try {
          // Create a backup plan in case the API call fails
          const backupResponses = {
            laptop: "Great choice! Let's find you the perfect laptop. Could you tell me your budget range?",
            smartphone: "Smartphones are essential these days! What's your budget for this purchase?",
            headphones: "I'd be happy to help you find headphones. What's your budget range?",
            budget: `Thanks for sharing your budget. What features are most important to you in a ${context.category}?`,
            preferences: `I understand you're looking for a ${context.category} with those features. Let me find some options for you.`,
            feedback: "Thanks for your feedback! Is there anything specific you'd like to know about these recommendations?"
          };

          const requestBody = {
            model: 'gpt-3.5-turbo',
            messages: [
              {
                role: 'system',
                content: `You are a product recommendation assistant. You help users find the perfect tech product based on their needs.
                          The available product categories are: laptops, smartphones, and headphones.
                          Current conversation context: ${JSON.stringify(context)}`
              },
              {
                role: 'user',
                content: prompt
              }
            ],
            temperature: 0.7,
            max_tokens: 150
          };

          console.log("Request payload:", requestBody);

          const response = await fetch(`${API_BASE_URL}/chat/completions`, {
            method: 'POST',
            headers: {
              'Content-Type': 'application/json',
              'Authorization': `Bearer ${OPENAI_API_KEY}`
            },
            body: JSON.stringify(requestBody)
          });

          console.log("API Response status:", response.status);

          // Handle non-OK responses
          if (!response.ok) {
            const errorText = await response.text();
            console.error("API Error:", errorText);

            // Try to parse error as JSON if possible
            let errorJson = {};
            try {
              errorJson = JSON.parse(errorText);
            } catch (e) {
              console.log("Error text is not valid JSON");
            }

            // Fall back to hardcoded responses based on context
            if (context.stage === 'initial' && context.category) {
              return backupResponses[context.category];
            } else if (context.stage === 'budget') {
              return backupResponses.budget;
            } else if (context.stage === 'preferences') {
              return backupResponses.preferences;
            } else if (context.stage === 'feedback') {
              return backupResponses.feedback;
            }

            // Default fallback
            throw new Error(`API call failed: ${response.status} - ${errorJson?.error?.message || 'Unknown error'}`);
          }

          const data = await response.json();
          console.log("API Response successful:", data);

          // Verify the response structure before returning
          if (data?.choices?.[0]?.message?.content) {
            return data.choices[0].message.content;
          }

          throw new Error("Invalid response structure from API");
        } catch (error) {
          console.error("Error calling OpenAI API:", error);

          // Use rules-based fallback responses instead of AI for this request
          if (prompt.includes("budget") || context.stage === 'budget') {
            return "What's your budget range for this purchase? This will help me find options that fit your needs.";
          } else if (prompt.includes("features") || context.stage === 'preferences') {
            return `What features or qualities are most important to you in a ${context.category || 'product'}? For example, battery life, performance, etc.`;
          } else if (context.stage === 'initial') {
            return "I'm looking forward to helping you find the perfect tech product. Are you interested in a laptop, smartphone, or headphones?";
          } else if (context.stage === 'feedback') {
            return "Thank you for your feedback! Is there anything specific you'd like to know about these recommendations?";
          }

          return "I'll help you find the perfect product based on your needs. To get started, what type of product are you looking for?";
        }
      };

      // Improved process message function that's more resilient to API failures and avoids loops
      const processMessage = async (userMessage) => {
        // Add user message to chat
        setMessages(prevMessages => [...prevMessages, { role: 'user', content: userMessage }]);

        // Simulate AI processing
        setIsTyping(true);

        // Parse user input for intent
        const lowercaseMessage = userMessage.toLowerCase();

        // Current context state for AI
        let newContext = { ...productContext };
        let useAI = false;
        let aiPrompt = "";
        let response = "";

        // Fix for the specific issue where the budget stage is skipped
// In the processMessage function, modify the initial stage logic:

// STAGE 1: Initial intent detection
        if (productContext.stage === 'initial') {
          // Check for product category
          const categoryKeywords = {
            'laptop': ['laptop', 'notebook', 'computer', 'pc', 'macbook'],
            'smartphone': ['phone', 'smartphone', 'mobile', 'iphone', 'android', 'cell phone'],
            'headphones': ['headphones', 'earbuds', 'headset', 'earphones', 'airpods']
          };

          let detectedCategory = null;
          Object.entries(categoryKeywords).forEach(([category, keywords]) => {
            if (keywords.some(keyword => lowercaseMessage.includes(keyword))) {
              detectedCategory = category;
            }
          });

          if (detectedCategory) {
            // Set category and ENSURE we move to budget stage
            newContext.category = detectedCategory;
            newContext.stage = 'budget'; // Make sure this is set to 'budget' not 'preferences'

            // Reset asked questions for new conversation
            setAskedQuestions({budget: false, features: false});

            // Use AI to respond with a budget question
            useAI = true;
            aiPrompt = `The user is looking for a ${detectedCategory}. Ask them specifically about their budget range for this purchase. For example: "What's your budget for this ${detectedCategory}?" or "How much are you looking to spend on this ${detectedCategory}?"`;

            // If API fails, use a backup response that explicitly asks about budget
            response = `Great! I'll help you find the perfect ${detectedCategory}. What's your budget range for this purchase?`;
          } else {
            // Use AI to understand the request better
            useAI = true;
            aiPrompt = `The user said: "${userMessage}". They might be looking for a tech product. Try to determine what category of product they're looking for (laptop, smartphone, or headphones). If unclear, ask them to specify what type of tech product they need.`;
          }
        }

// Then make sure the "budget" stage properly transitions to "preferences"
// and doesn't skip directly to "recommendation"

// Improved budget detection in the budget stage
        else if (productContext.stage === 'budget') {
          // Extract budget information with improved pattern matching
          const budgetRegex = /\$?(\d+)(?:\s*-\s*\$?(\d+))?/;
          const budgetMatch = lowercaseMessage.match(budgetRegex);

          // Also check for budget keywords
          const hasBudgetKeywords = lowercaseMessage.includes('budget') ||
                  lowercaseMessage.includes('price') ||
                  lowercaseMessage.includes('cost') ||
                  lowercaseMessage.includes('spend') ||
                  lowercaseMessage.includes('dollar');

          // Debug
          console.log("Checking budget in:", lowercaseMessage);
          console.log("Budget match:", budgetMatch);

          if (budgetMatch) {
            console.log("Budget match found:", budgetMatch);
            // Extract budget from regex match
            if (budgetMatch[2]) {
              // Range provided
              const minBudget = parseInt(budgetMatch[1]);
              const maxBudget = parseInt(budgetMatch[2]);
              newContext.budget = { min: minBudget, max: maxBudget };
              console.log(`Budget range set: $${minBudget}-$${maxBudget}`);
            } else {
              // Single value provided, treat as maximum
              const maxBudget = parseInt(budgetMatch[1]);
              newContext.budget = { max: maxBudget };
              console.log(`Budget max set: $${maxBudget}`);
            }

            // IMPORTANT: Always move to preferences stage when budget is detected
            newContext.stage = 'preferences';
            console.log("Moving to preferences stage");

            // Use AI for response
            useAI = true;
            aiPrompt = `The user has specified a budget of ${newContext.budget.min ? `$${newContext.budget.min} to $${newContext.budget.max}` : `up to $${newContext.budget.max}`} for a ${newContext.category}. Ask them about what features or qualities are important to them.`;

            // Fallback response if AI fails
            response = `Thanks for sharing your budget. What features are most important to you in a ${newContext.category}?`;
          }
          // Check if they've already been asked about budget and are mentioning budget terms
          else if (askedQuestions.budget && hasBudgetKeywords) {
            console.log("User mentioned budget terms but no specific amount");
            // Set a reasonable default if they're talking about budget but not giving specific numbers
            newContext.budget = { max: 500 }; // Default budget
            newContext.stage = 'preferences';

            useAI = true;
            aiPrompt = `The user mentioned budget but didn't specify an exact amount for their ${newContext.category}. Ask them what features they're looking for.`;

            response = `Thanks for that information. What specific features are you looking for in a ${newContext.category}?`;
          }
          // Allow switching product category from budget stage
          else if (lowercaseMessage.includes('laptop') ||
                  lowercaseMessage.includes('phone') ||
                  lowercaseMessage.includes('headphone')) {
            console.log("User wants to switch product category");

            // Detect new category
            if (lowercaseMessage.includes('laptop')) {
              newContext.category = 'laptop';
            } else if (lowercaseMessage.includes('phone')) {
              newContext.category = 'smartphone';
            } else if (lowercaseMessage.includes('headphone') || lowercaseMessage.includes('earphone')) {
              newContext.category = 'headphones';
            }

            // Keep in budget stage with new category
            newContext.stage = 'budget';

            useAI = true;
            aiPrompt = `The user now wants to look for a ${newContext.category} instead. Ask them about their budget for this ${newContext.category}.`;

            response = `Great! I'll help you find the perfect ${newContext.category}. What's your budget range for this purchase?`;
          }
          else {
            // First time asking about budget
            setAskedQuestions(prev => ({...prev, budget: true}));

            useAI = true;
            aiPrompt = `The user said: "${userMessage}" when asked about their budget for a ${newContext.category}. Ask them again for a specific budget range with dollar amounts.`;

            response = `I need a specific budget range to help you find the right ${newContext.category}. Could you please give me an amount, like "$100-$200" or "up to $300"?`;
          }
        }
        // STAGE 3: Preferences collection with loop prevention
        else if (productContext.stage === 'preferences') {
          // Set asked flag
          setAskedQuestions(prev => ({...prev, features: true}));

          // Already asked about features, move to recommendation stage regardless of input
          // Store any preferences mentioned
          newContext.preferences = [...productContext.preferences, userMessage];
          newContext.stage = 'recommendation';

          // Use AI to understand preferences
          useAI = true;
          aiPrompt = `The user is looking for a ${newContext.category} with a budget of ${newContext.budget.min ? `$${newContext.budget.min}-$${newContext.budget.max}` : `up to $${newContext.budget.max}`}. They said: "${userMessage}" about their preferences. Extract key features they're looking for and tell them you'll find some recommendations.`;

          // Wait for AI response before generating recommendations
          response = await callOpenAI(aiPrompt, newContext);
          setMessages(prevMessages => [...prevMessages, { role: 'assistant', content: response }]);

          // Filter products based on category
          let filteredProducts = products.filter(p => p.category === newContext.category);

          // Filter by budget if available
          if (newContext.budget) {
            if (newContext.budget.min && newContext.budget.max) {
              filteredProducts = filteredProducts.filter(p => p.price >= newContext.budget.min && p.price <= newContext.budget.max);
            } else if (newContext.budget.max) {
              filteredProducts = filteredProducts.filter(p => p.price <= newContext.budget.max);
            }
          }

          // Get relevant keywords from user preferences
          const preferencesText = newContext.preferences.join(' ').toLowerCase();

          // Score products based on how well they match preferences
          filteredProducts = filteredProducts.map(product => {
            let score = 0;

            // Check features
            product.features.forEach(feature => {
              const featureLower = feature.toLowerCase();
              if (preferencesText.includes(featureLower)) {
                // Higher score for exact matches
                score += 2;
              }
            });

            // Check idealFor
            product.idealFor.forEach(idealFor => {
              if (preferencesText.includes(idealFor.toLowerCase())) {
                score += 1;
              }
            });

            return { ...product, score };
          }).sort((a, b) => {
            // Sort by score first, then by rating if scores are equal
            if (b.score !== a.score) {
              return b.score - a.score;
            }
            return b.rating - a.rating;
          });

          // Take top 3 recommendations
          const recommendations = filteredProducts.slice(0, 3);

          if (recommendations.length > 0) {
            // Create recommendations message
            setTimeout(() => {
              setMessages(prevMessages => [
                ...prevMessages,
                { role: 'assistant', content: 'Based on your preferences, here are my top recommendations:' },
                { role: 'assistant', content: '', recommendations }
              ]);

              // Reset context for new recommendations
              setProductContext({
                category: null,
                budget: null,
                preferences: [],
                stage: 'feedback'
              });
              // Also reset asked questions for new conversation
              setAskedQuestions({budget: false, features: false});
              setIsTyping(false);
            }, 2000); // Delay to simulate processing time

            return;
          } else {
            response = `I couldn't find any ${newContext.category} that match your criteria. Would you like to try with a different budget or category?`;
            newContext.stage = 'initial';
            // Reset asked questions for new search
            setAskedQuestions({budget: false, features: false});
            useAI = false;
          }
        }
        // STAGE 4: Handle feedback
        else if (productContext.stage === 'feedback') {
          // Check for request to start over
          if (lowercaseMessage.includes('new search') ||
                  lowercaseMessage.includes('start over') ||
                  lowercaseMessage.includes('different') ||
                  lowercaseMessage.includes('something else')) {

            newContext = {
              category: null,
              budget: null,
              preferences: [],
              stage: 'initial'
            };

            // Reset asked questions for new search
            setAskedQuestions({budget: false, features: false});

            response = "I'd be happy to help you find something else! What type of product are you looking for?";
            useAI = false;
          } else {
            // Use AI to respond to feedback
            useAI = true;
            aiPrompt = `The user said: "${userMessage}" after receiving product recommendations. Respond to their feedback or answer questions about the recommended products. If they ask for more specific information, suggest they could refine their search criteria.`;
          }
        }

        // Call OpenAI API if needed
        if (useAI && !response) {
          response = await callOpenAI(aiPrompt, newContext);
        }

        // Set new context and add assistant message
        setProductContext(newContext);
        setMessages(prevMessages => [...prevMessages, { role: 'assistant', content: response }]);
        setIsTyping(false);
      };

      const handleSubmit = async (e) => {
        e.preventDefault();
        if (inputText.trim() === '') return;

        await processMessage(inputText);
        setInputText('');
      };

      // Handle demo buttons for predefined flows
      const runDemo = async (demoType) => {
        switch(demoType) {
          case 'laptop':
            await processMessage("I need a new laptop for work");
            setTimeout(async () => {
              await processMessage("My budget is around $1000-1500");
              setTimeout(async () => {
                await processMessage("I need something with good battery life and powerful enough for video editing");
              }, 3000);
            }, 3000);
            break;
          case 'phone':
            await processMessage("Looking for a new smartphone");
            setTimeout(async () => {
              await processMessage("I can spend up to $800");
              setTimeout(async () => {
                await processMessage("I really care about camera quality and battery life");
              }, 3000);
            }, 3000);
            break;
          case 'headphones':
            await processMessage("I want wireless headphones");
            setTimeout(async () => {
              await processMessage("Under $200 please");
              setTimeout(async () => {
                await processMessage("Noise cancellation would be nice for my commute");
              }, 3000);
            }, 3000);
            break;
        }
      };

      return (
              <div className="flex flex-col h-full max-w-6xl mx-auto bg-gray-50">
                <div className="flex flex-col h-full">
                  {/* Header */}
                  <div className="bg-blue-600 text-white p-4 shadow-md">
                    <h1 className="text-2xl font-bold">Product AI Assistant</h1>
                    <p className="text-sm opacity-90">Ask me about tech products and I'll help you find the perfect match using AI</p>
                  </div>

                  {/* Demo buttons */}
                  <div className="bg-blue-100 p-3 flex space-x-2 overflow-x-auto">
                    <span className="text-sm text-blue-800 font-medium whitespace-nowrap my-auto">Try a demo:</span>
                    <button
                            onClick={() => runDemo('laptop')}
                            className="bg-white hover:bg-blue-50 text-blue-600 text-sm font-medium py-1 px-3 rounded-full shadow-sm"
                    >
                      Laptop search
                    </button>
                    <button
                            onClick={() => runDemo('phone')}
                            className="bg-white hover:bg-blue-50 text-blue-600 text-sm font-medium py-1 px-3 rounded-full shadow-sm"
                    >
                      Smartphone search
                    </button>
                    <button
                            onClick={() => runDemo('headphones')}
                            className="bg-white hover:bg-blue-50 text-blue-600 text-sm font-medium py-1 px-3 rounded-full shadow-sm"
                    >
                      Headphones search
                    </button>
                  </div>

                  {/* Messages container */}
                  <div className="flex-1 overflow-y-auto p-4 bg-white">
                    {messages.map((message, index) => (
                            <div key={index} className={`mb-4 ${message.role === 'user' ? 'text-right' : ''}`}>
                              {/* Regular message */}
                              {!message.recommendations && (
                                      <div className={`inline-block p-3 rounded-lg max-w-3xl ${
                                              message.role === 'user'
                                                      ? 'bg-blue-500 text-white rounded-br-none'
                                                      : 'bg-gray-100 text-gray-800 rounded-bl-none'
                                      }`}>
                                        {message.content}
                                      </div>
                              )}

                              {/* Recommendations display */}
                              {message.recommendations && (
                                      <div className="grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 gap-4 mt-2">
                                        {message.recommendations.map((product) => (
                                                <div key={product.id} className="bg-white rounded-lg border border-gray-200 shadow-sm overflow-hidden">
                                                  <img
                                                          src={product.image}
                                                          alt={product.name}
                                                          className="w-full h-40 object-cover"
                                                  />
                                                  <div className="p-4">
                                                    <div className="flex justify-between items-start mb-2">
                                                      <h3 className="font-bold text-lg">{product.name}</h3>
                                                      <span className="font-bold text-blue-600">${product.price}</span>
                                                    </div>
                                                    <div className="flex items-center mb-2">
                                                      <div className="flex text-yellow-400">
                                                        {'★'.repeat(Math.floor(product.rating))}
                                                        {'☆'.repeat(5 - Math.floor(product.rating))}
                                                      </div>
                                                      <span className="text-sm text-gray-600 ml-1">{product.rating}</span>
                                                    </div>
                                                    <ul className="text-sm text-gray-600 mb-3">
                                                      {product.features.slice(0, 3).map((feature, idx) => (
                                                              <li key={idx} className="flex items-start mb-1">
                                                                <span className="text-green-500 mr-1">✓</span>
                                                                {feature}
                                                              </li>
                                                      ))}
                                                    </ul>
                                                    <p className="text-xs text-gray-500 mt-1">
                                                      Ideal for: {product.idealFor.join(', ')}
                                                    </p>
                                                  </div>
                                                </div>
                                        ))}
                                      </div>
                              )}
                            </div>
                    ))}

                    {/* Typing indicator */}
                    {isTyping && (
                            <div className="flex items-center space-x-2 mb-4">
                              <div className="bg-gray-100 p-3 rounded-lg text-gray-500">
                                <div className="flex space-x-1">
                                  <div className="w-2 h-2 bg-gray-400 rounded-full animate-pulse"></div>
                                  <div className="w-2 h-2 bg-gray-400 rounded-full animate-pulse delay-75"></div>
                                  <div className="w-2 h-2 bg-gray-400 rounded-full animate-pulse delay-150"></div>
                                </div>
                              </div>
                            </div>
                    )}

                    <div ref={messagesEndRef} />
                  </div>

                  {/* Input form */}
                  <form onSubmit={handleSubmit} className="p-4 border-t border-gray-200 bg-white">
                    <div className="flex">
                      <input
                              type="text"
                              value={inputText}
                              onChange={(e) => setInputText(e.target.value)}
                              className="flex-1 border border-gray-300 rounded-l-lg px-4 py-2 focus:outline-none focus:ring-2 focus:ring-blue-500"
                              placeholder="Ask about products..."
                              disabled={isTyping}
                      />
                      <button
                              type="submit"
                              className="bg-blue-500 hover:bg-blue-600 text-white px-4 py-2 rounded-r-lg disabled:bg-blue-300"
                              disabled={isTyping || inputText.trim() === ''}
                      >
                        <svg xmlns="http://www.w3.org/2000/svg" className="h-5 w-5" viewBox="0 0 20 20" fill="currentColor">
                          <path fillRule="evenodd" d="M10.293 3.293a1 1 0 011.414 0l6 6a1 1 0 010 1.414l-6 6a1 1 0 01-1.414-1.414L14.586 11H3a1 1 0 110-2h11.586l-4.293-4.293a1 1 0 010-1.414z" clipRule="evenodd" />
                        </svg>
                      </button>
                    </div>
                  </form>
                </div>
              </div>
      );
    };
  })();

  // Set up App component
  const App = () => {
    return (
            <div className="App h-full">
              <ProductRecommender />
            </div>
    );
  };

  // Render the App to the DOM
  ReactDOM.render(<App />, document.getElementById('root'));
</script>
</body>
</html>